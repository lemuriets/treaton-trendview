<Window x:Class="LogDecoder.GUI.TrendView"
         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         xmlns:oxy="http://oxyplot.org/wpf"
         xmlns:views="clr-namespace:LogDecoder.GUI.Views"
         xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
         xmlns:conv="clr-namespace:LogDecoder.GUI.Converters"
         Title="TrendView"
         ResizeMode="CanResize"
         Height="720" Width="1100"
         MinHeight="720" MinWidth="800"
         PreviewKeyDown="Window_PreviewKeyDown">
    
    <Window.Resources>
        <conv:NaNToPlaceholderConverter x:Key="NaNToPlaceholderConverter" />
        <conv:BatteryConverter x:Key="BatteryConverter" />
    </Window.Resources>
    
    <Window.InputBindings>
        <KeyBinding Key="Left" Command="{Binding MoveCursorsLeftCommand}"/>
        <KeyBinding Key="Right" Command="{Binding MoveCursorsRightCommand}"/>
    </Window.InputBindings>
    
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="320"/>
            </Grid.ColumnDefinitions>

            <DockPanel Grid.Column="0" LastChildFill="True" Margin="0,0,8,0">
                <StackPanel DockPanel.Dock="Top">
                    <StackPanel Orientation="Horizontal" Margin="4" HorizontalAlignment="Left">
                        <TextBlock Text="Масштаб:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <ComboBox x:Name="SelectPlotScale"
                                  Width="100"
                                  ItemsSource="{Binding Scales}"
                                  SelectedItem="{Binding Scale, Mode=TwoWay}">
                        </ComboBox>
                        <TextBlock x:Name="TxtInfo" Margin="12,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel>
                    <UniformGrid Columns="1" Rows="3" Margin="0,8,0,0" Height="580">
                        <views:PlotBox x:Name="PlotBox1" DataContext="{Binding PlotBox1}" />
                        <views:PlotBox x:Name="PlotBox2" DataContext="{Binding PlotBox2}" />
                        <views:PlotBox x:Name="PlotBox3" DataContext="{Binding PlotBox3}" />
                    </UniformGrid>

                    <StackPanel Orientation="Horizontal" Margin="6,8,0,4" VerticalAlignment="Center" >
                        <TextBlock Text="Начало:" VerticalAlignment="Center" Margin="0,0,6,0" Foreground="DimGray"/>
                        <xctk:DateTimePicker x:Name="DtpStart" Value="{Binding StartDateTime, Mode=TwoWay}" Width="200" Format="Custom" FormatString="dd.MM.yyyy HH:mm:ss" TextAlignment="Left" />
                        
                        <TextBlock x:Name="TxtRangeDate" Text="{Binding CurrentDateTime, StringFormat={}{0:dd.MM.yyyy HH:mm:ss}}" Margin="20,4,0,6" Foreground="#000"/>
                        <TextBlock x:Name="TxtError" Text="{Binding TxtError}" Foreground="Red" TextWrapping="Wrap" Margin="10,4,10,0"/>
                    </StackPanel>
                </StackPanel>
            </DockPanel>

            <Border Grid.Column="1" BorderBrush="#444" BorderThickness="1" CornerRadius="4" Padding="8" Background="#0b0b0d">
                <StackPanel>
                    <UniformGrid Columns="2" Rows="1" Margin="0,0,0,6">
                        <TextBlock Text="Заряд аккумулятора:" Foreground="LightGray"/>
                        <TextBlock x:Name="ValBattery" Text="{Binding ValBattery, Converter={StaticResource BatteryConverter}}" Foreground="#7CFF7C" FontWeight="Bold"/>
                    </UniformGrid>

                    <TextBlock Text="Параметры вентиляции" FontWeight="Bold" Foreground="White" Margin="0,0,0,8"/>
                    <UniformGrid Columns="2" Rows="10" Margin="0,0,0,6">
                        <TextBlock Text="PIP (cmH₂O):" Foreground="LightGray"/>
                        <TextBlock x:Name="ValPIP" Text="{Binding ValPIP, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#7CFF7C" FontWeight="Bold"/>

                        <TextBlock Text="PEEP (cmH₂O):" Foreground="LightGray"/>
                        <TextBlock x:Name="ValPEEP" Text="{Binding ValPEEP, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#7CFF7C" FontWeight="Bold"/>

                        <TextBlock Text="MV общая (L/min):" Foreground="LightGray"/>
                        <TextBlock x:Name="ValMVTotal" Text="{Binding ValMVTotal, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#FFB966" FontWeight="Bold"/>
                        
                        <TextBlock Text="MV аппаратная (L/min):" Foreground="LightGray"/>
                        <TextBlock x:Name="ValMVMachine" Text="{Binding ValMVMachine, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#FFB966" FontWeight="Bold"/>

                        <TextBlock Text="Vt (ml):" Foreground="LightGray"/>
                        <TextBlock x:Name="ValVt" Text="{Binding ValVt, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#FFB966" FontWeight="Bold"/>

                        <TextBlock Text="RB (1/min):" Foreground="LightGray"/>
                        <TextBlock x:Name="ValRB1" Text="{Binding ValRB1, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#FFD700" FontWeight="Bold"/>
                        
                        <TextBlock Text="RB самостоятельный (1/min):" Foreground="LightGray"/>
                        <TextBlock x:Name="ValRB2" Text="{Binding ValRB2, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#FFD700" FontWeight="Bold"/>

                        <TextBlock Text="Cst:" Foreground="LightGray"/>
                        <TextBlock x:Name="ValCst" Text="{Binding ValCst, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#FFFFFF" FontWeight="Bold"/>
                        
                        <TextBlock Text="Rst:" Foreground="LightGray"/>
                        <TextBlock x:Name="ValRst" Text="{Binding ValRst, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#FFFFFF" FontWeight="Bold"/>
                        
                        <TextBlock Text="Rst:" Foreground="LightGray"/>
                        <TextBlock x:Name="ValLeak" Text="{Binding ValLeak, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#FFFFFF" FontWeight="Bold"/>
                    </UniformGrid>

                    <Separator Margin="0,6,0,6"/>

                    <TextBlock Text="Фиксированные параметры" FontWeight="Bold" Foreground="LightGray" Margin="0,0,0,8"/>
                    <UniformGrid Columns="2" Rows="3" Margin="0,0,0,6">
                        <TextBlock Text="Pmax (cmH₂O):" Foreground="LightGray"/>
                        <TextBlock x:Name="ValPmax" Text="{Binding ValPmax, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#FF7A7A" FontWeight="Bold"/>

                        <TextBlock Text="Tinsp (sec):" Foreground="LightGray"/>
                        <TextBlock x:Name="ValTinsp" Text="{Binding ValTinsp, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#FFFFFF" FontWeight="Bold"/>

                        <TextBlock Text="Ftrig (L/min):" Foreground="LightGray"/>
                        <TextBlock x:Name="ValFtrig" Text="{Binding ValFtrig, Converter={StaticResource NaNToPlaceholderConverter}}" Foreground="#FFFFFF" FontWeight="Bold"/>
                    </UniformGrid>
                    
                    <Separator Margin="0,6,0,6"/>
                    
                    <TextBlock Text="Ошибки" FontWeight="Bold" Foreground="LightGray" Margin="0,0,0,8"/>

                    <Border BorderBrush="#333" BorderThickness="1" CornerRadius="4"
                            Padding="4" Background="#1A1A1D">
                        <ListBox ItemsSource="{Binding Messages}"
                                 Height="250"
                                 Background="#1A1A1D"
                                 BorderThickness="0"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto">

                            <ListBox.Resources>
                                <!-- Стиль для элементов списка -->
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Background" Value="#1A1A1D"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Focusable" Value="False"/>

                                    <!-- Убираем подсветку при наведении -->
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ListBoxItem">
                                                <Border Background="{TemplateBinding Background}">
                                                    <ContentPresenter/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.Resources>

                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Text}"
                                               TextWrapping="Wrap"
                                               Margin="0,0,0,6">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="White"/>

                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Status}" Value="Ok">
                                                        <Setter Property="Foreground" Value="#7FFF7F"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="Info">
                                                        <Setter Property="Foreground" Value="#5DAEFF"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="Warning">
                                                        <Setter Property="Foreground" Value="#FFC107"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="Error">
                                                        <Setter Property="Foreground" Value="#FF4D4D"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="Critical">
                                                        <Setter Property="Foreground" Value="#FF007F"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
